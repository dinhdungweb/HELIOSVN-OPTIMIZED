{{ 'account.css' | asset_url | stylesheet_tag: preload: true }}

<!-- Tính tổng chi tiêu -->
{% if customer.metafields.custom.total_spent != blank and customer.metafields.custom.total_spent != 0 %}
  {% assign total_spent = customer.metafields.custom.total_spent | plus: 0 %}
{% else %}
  {% assign total_spent = customer.total_spent | divided_by: 100 %}
{% endif %}
{% assign points = customer.metafields.rewards.points | default: 0 %}

<!-- Kiểm tra tag khách hàng -->
{% if customer.tags contains "BLACK DIAMOND" %}
  {% assign tier = "BLACK DIAMOND" %}
  {% assign next_tier = "MAX LEVEL" %}
  {% assign next_tier_amount = total_spent %}
{% elsif customer.tags contains "DIAMOND" %}
  {% assign tier = "DIAMOND" %}
  {% assign next_tier = "BLACK DIAMOND" %}
  {% assign next_tier_amount = 100000000 %}
{% elsif customer.tags contains "PLATINUM" %}
  {% assign tier = "PLATINUM" %}
  {% assign next_tier = "DIAMOND" %}
  {% assign next_tier_amount = 20000000 %}
{% elsif customer.tags contains "GOLD" %}
  {% assign tier = "GOLD" %}
  {% assign next_tier = "PLATINUM" %}
  {% assign next_tier_amount = 10000000 %}
{% elsif customer.tags contains "SILVER" %}
  {% assign tier = "SILVER" %}
  {% assign next_tier = "GOLD" %}
  {% assign next_tier_amount = 6000000 %}
{% else %}
  <!-- Nếu không có tag, xác định cấp bậc bằng tổng tiền đã chi -->
  {% if total_spent < 3000000 %}
    {% assign tier = "MEMBER" %}
    {% assign next_tier = "SILVER" %}
    {% assign next_tier_amount = 3000000 %}
  {% elsif total_spent >= 3000000 and total_spent < 6000000 %}
    {% assign tier = "SILVER" %}
    {% assign next_tier = "GOLD" %}
    {% assign next_tier_amount = 6000000 %}
  {% elsif total_spent >= 6000000 and total_spent < 10000000 %}
    {% assign tier = "GOLD" %}
    {% assign next_tier = "PLATINUM" %}
    {% assign next_tier_amount = 10000000 %}
  {% elsif total_spent >= 10000000 and total_spent < 20000000 %}
    {% assign tier = "PLATINUM" %}
    {% assign next_tier = "DIAMOND" %}
    {% assign next_tier_amount = 20000000 %}
  {% elsif total_spent >= 20000000 and total_spent < 100000000 %}
    {% assign tier = "DIAMOND" %}
    {% assign next_tier = "BLACK DIAMOND" %}
    {% assign next_tier_amount = 100000000 %}
  {% else %}
    {% assign tier = "BLACK DIAMOND" %}
    {% assign next_tier = "MAX LEVEL" %}
    {% assign next_tier_amount = total_spent %}
  {% endif %}
{% endif %}

<div class="custom-tier-content">
        {% case tier %}
          {% when "BLACK DIAMOND" %}
            <div class="welcome-tier">
              <p>CHÀO MỪNG NGƯỜI ANH EM "KIM CƯƠNG ĐEN" CỦA HELIOS
              <br>BẠN CHÍNH LÀ PHẦN KHÔNG THỂ THIẾU TẠO NÊN HELIOS HÔM NAY
              <br>CÁC ĐẶC QUYỀN CAO CẤP NHẤT CHÚNG TÔI SẼ DÀNH RIÊNG CHO BẠN</p>
            </div>
          {% when "DIAMOND" %}
            <div class="welcome-tier">
              <p>CHÀO MỪNG NGƯỜI ANH EM "KIM CƯƠNG" CỦA HELIOS
              <br>BẠN LÀ TOP 1% KHÁCH HÀNG CAO CẤP NHẤT CỦA CHÚNG TÔI
              <br>CÁC TRẢI NGHIỆM VÀ SẢN PHẨM ĐẶC QUYỀN LÀ MÓN QUÀ CHO SỰ ĐỒNG HÀNH CỦA BẠN</p>
            </div>
          {% when "PLATINUM" %}
            <div class="welcome-tier">
              <p>CHÀO MỪNG NGƯỜI ANH EM "BẠCH KIM" CỦA HELIOS
              <br>BẠN ĐANG THUỘC VÀO NHÓM KHÁCH HÀNG CAO CẤP CỦA CHÚNG TÔI
              <br>CÁC ƯU ĐÃI VÀ TRẢI NGHIỆM ĐỀU SẼ ĐƯỢC ƯU TIÊN CHO BẠN</p>
            </div>
          {% when "GOLD" %}
            <div class="welcome-tier">
              <p>CHÀO MỪNG NGƯỜI ANH EM "VÀNG" CỦA HELIOS
              <br>CẢM ƠN BẠN ĐÃ CHỌN HELIOS NHIỀU HƠN MỘT LẦN
              <br>CÁC ĐẶC QUYỀN Ở ĐÂY LÀ CÁCH CHÚNG TÔI CẢM ƠN SỰ LỰA CHỌN ĐÓ</p>
            </div>
          {% when "SILVER" %}
            <div class="welcome-tier">
              <p>CHÀO MỪNG NGƯỜI ANH EM "BẠC" CỦA HELIOS
              <br>BẠN ĐÃ TÌM ĐƯỢC THỨ THUỘC VỀ MÌNH Ở ĐÂY
              <br>MONG HÀNH TRÌNH CỦA BẠN SẼ TIẾP TỤC CÓ CÙNG HELIOS</p>
            </div>
          {% else %}
            <div class="welcome-tier">
              <p>CHÀO MỪNG NGƯỜI ANH EM
              <br>HÀNH TRÌNH CỦA BẠN VỚI HELIOS ĐÃ BẮT ĐẦU
              <br>HÃY SẴN SÀNG NHẬN NHỮNG BẤT NGỜ THÚ VỊ NHẤT</p>
            </div>
        {% endcase %}
      </div>

<!-- Tính phần trăm tiến trình -->
{% assign progress_percentage = total_spent | times: 100 | divided_by: next_tier_amount %}
{% assign remaining_amount = next_tier_amount | minus: total_spent %}
<div class="wide-container customer-account-container">
  <div class="customer-sidebar">
    <div class="customer-info">
      <div class="customer-info-header flex justify-between align-center">
        <div class="customer-info-name flex align-center">
          <div class="customer-avatar"></div>
          <div class="customer-name-email">
            <div>Xin chào, <strong>{{ customer.name }}</strong></div>
            <div class="text-ellipsis">{{ customer.email }}</div>
          </div>
        </div> 
        <a href="{{ routes.account_logout_url }}" class="logout-button">Đăng xuất</a>
      </div>
      <div class="customer-total-spent flex justify-between align-center mt-14 mb-5">
        <div>Tổng chi tiêu: </div>
        <div>
          {% assign formatted_total_spent = total_spent | floor | split: '' | reverse %}
          {% assign formatted_number = '' %}
          
          {% for digit in formatted_total_spent %}
            {% assign remainder = forloop.index0 | modulo: 3 %}
            {% if remainder == 0 and forloop.index0 != 0 %}
              {% assign formatted_number = formatted_number | append: '.' %}
            {% endif %}
            {% assign formatted_number = formatted_number | append: digit %}
          {% endfor %}
          
          {% assign formatted_number = formatted_number | split: '' | reverse | join: '' %}
          <strong>{{ formatted_number }} VND</strong>
        </div>
      </div>
      <div class="customer-tier flex justify-between align-center mb-14">
        <div>Hạng — <strong>{{ tier }}</strong></div>
        <div>Điểm — <strong>{{ points }}</strong></div>
      </div>
      <div class="progress-container">
        <div class="progress-bar">
          <span class="progress-fill" style="width: {{ progress_percentage }}%;"></span>
        </div>
        <p class="progress-status">
          {% if tier == "BLACK DIAMOND" %}
            Bạn đã đạt hạng cao nhất!
          {% else %}
            {% assign formatted_remaining_amount = remaining_amount | floor | split: '' | reverse %}
            {% assign formatted_remaining = '' %}
            
            {% for digit in formatted_remaining_amount %}
              {% assign remainder = forloop.index0 | modulo: 3 %}
              {% if remainder == 0 and forloop.index0 != 0 %}
                {% assign formatted_remaining = formatted_remaining | append: '.' %}
              {% endif %}
              {% assign formatted_remaining = formatted_remaining | append: digit %}
            {% endfor %}
            
            {% assign formatted_remaining = formatted_remaining | split: '' | reverse | join: '' %}

            Cần tiêu thêm <strong>{{ formatted_remaining }} VND</strong> để lên hạng <strong>{{ next_tier }}</strong>.
          {% endif %}
        </p>
      </div>

    </div>
    <ul class="account-tabs">
      <li class="tab-link active" data-tab="rewards">Welcome to Helios</li>
      <li class="tab-link" data-tab="account">Tài khoản</li>
      <li class="tab-link" data-tab="orders">Đơn hàng</li>
      {% comment %} <li class="tab-link" data-tab="benefits">Befenits / Promos</li> {% endcomment %}
      <li class="tab-link" data-tab="discord">Helios Club</li>
      <!-- <li class="tab-link" data-tab="wishlist">Yêu thích</li> -->
    </ul>
  </div>

  <div class="customer-content">
    <div id="rewards" class="customer-tab-content active">
    <div class="befenits-container">
        <div class="benefits-section">
            <h2 class="section-title">Đặc quyền thành viên</h2>
            
            <div class="benefits-grid">
                <div class="benefit-card">
		            <div class="benefit-image"><img src="https://cdn.shopify.com/s/files/1/0644/2958/8701/files/z7259963369438_ec7429242ff9a2df74da93a5468d2689.jpg?v=1764043415" loading="lazy"></div>
                    <p class="benefit-text">Sản phẩm chỉ dành cho member</p>
                </div>

                <div class="benefit-card">
                    <div class="benefit-image"><img src="https://cdn.shopify.com/s/files/1/0644/2958/8701/files/SRK00419_1.jpg?v=1764047396" loading="lazy"></div>
                    <p class="benefit-text">Nhận thông tin sản phẩm mới nhất</p>
                </div>

                <div class="benefit-card">
                    <div class="benefit-image"><img src="https://cdn.shopify.com/s/files/1/0644/2958/8701/files/z7259917099574_52ff3fb875c398980791c9c98be4b9b6.jpg?v=1764043414" loading="lazy"></div>
                    <p class="benefit-text">Quà tặng miễn phí</p>
                </div>
            </div>
            <div class="benefits-section">
                <div class="benefits-grid">
                    <div class="benefit-card-reward">
                        <div class="icon-wrapper">
                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M20 7L12 3L4 7M20 7L12 11M20 7V17L12 21M12 11L4 7M12 11V21M4 7V17L12 21" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h3 class="benefit-title">CHIẾT KHẤU<br/>SẢN PHẨM BẠC<br/>VÀ HỢP KIM</h3>
                    </div>

                    <div class="benefit-card-reward-tier">
                        <div class="icon-wrapper">
                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h3 class="benefit-title">CHIẾT KHẤU<br/>SẢN PHẨM VÀNG:<br/>18K/14K/10K/9K<br/>VÀ KIM CƯƠNG</h3>
                    </div>

                    <div class="benefit-card-reward">
                        <div class="icon-wrapper">
                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16 21V5C16 3.89543 16.8954 3 18 3C19.1046 3 20 3.89543 20 5V19C20 20.1046 19.1046 21 18 21H6C4.89543 21 4 20.1046 4 19V9C4 7.89543 4.89543 7 6 7H16" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h3 class="benefit-title">ưu đãi<br/>FREESHIP</h3>
                    </div>

                    <div class="benefit-card-reward">
                        <div class="icon-wrapper">
                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 8V12L15 15M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h3 class="benefit-title">ĐẶT TRƯỚC 1 TUẦN<br/>KHI RA MẮT BST MỚI</h3>
                    </div>

                    <div class="benefit-card-reward">
                        <div class="icon-wrapper">
                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 7V20M12 7L8 10.2M12 7L16 10.2M9 20H15C16.6569 20 18 18.6569 18 17C18 15.3431 16.6569 14 15 14H9C7.34315 14 6 15.3431 6 17C6 18.6569 7.34315 20 9 20Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 7C13.6569 7 15 5.65685 15 4C15 2.34315 13.6569 1 12 1C10.3431 1 9 2.34315 9 4C9 5.65685 10.3431 7 12 7Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h3 class="benefit-title">QUÀ SINH NHẬT<br/>KHÁCH HÀNG</h3>
                    </div>

                    <div class="benefit-card-reward">
                        <div class="icon-wrapper">
                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M17 9V7C17 4.79086 15.2091 3 13 3H11C8.79086 3 7 4.79086 7 7V9M7 9H17M7 9C5.34315 9 4 10.3431 4 12V19C4 20.6569 5.34315 22 7 22H17C18.6569 22 20 20.6569 20 19V12C20 10.3431 18.6569 9 17 9M10 16H14" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h3 class="benefit-title">SẢN PHẨM QUÀ<br/>TẶNG ĐẶC BIỆT<br/>CHO KHÁCH HÀNG</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <div id="account" class="customer-tab-content">
      <h3 style="text-align:left">Chi tiết tài khoản</h3>
      <p><strong>Họ và tên:</strong> {{ customer.name }}</p>
      <p><strong>Số điện thoại:</strong> {{ customer.phone }}</p>
      <p><strong>Email:</strong> {{ customer.email }}</p>
      <p><strong>Địa chỉ:</strong> 
        {% for address in customer.addresses %}
          {{ address.company }} {{ address.street }}, {{ address.city }} {% if address.province_code %}, {{ address.province_code }}{% endif %}, {{ address.country }} {{ address.zip }}
        {% endfor %}
      </p>
      <a class="logout-button" href="{{ routes.account_addresses_url }}">Sửa thông tin</a>
    </div>

    <div id="orders" class="customer-tab-content">
      <h3 style="text-align:left">Đơn hàng</h3>
      {% paginate customer.orders by 20 %}
      {% if customer.orders.size != 0 %}
      <table class="orders-table">
        <thead>
          <tr>
            <th>Order</th>
            <th>Date</th>
            <th>Status</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          {% for order in customer.orders %}
          <tr>
            <td><a href="{{ order.customer_url }}">{{ order.name }}</a></td>
            <td>{{ order.created_at | date: format: 'month_date_year' }}</td>
            <td>{{ order.financial_status_label }}</td>
            <td>{{ order.total_price | money }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}<p>No orders found.</p>{% endif %}
      {% endpaginate %}
    </div>

    <div id="benefits" class="customer-tab-content">
      <h3 style="text-align:left">Benefits & Promos</h3>
      <div class="custom-tier-content">
        {% case tier %}
          {% when "BLACK DIAMOND" %}
            {{ section.settings.content_black_diamond | raw }}
          {% when "DIAMOND" %}
            {{ section.settings.content_diamond | raw }}
          {% when "PLATINUM" %}
            {{ section.settings.content_platinum | raw }}
          {% when "GOLD" %}
            {{ section.settings.content_gold | raw }}
          {% when "SILVER" %}
            {{ section.settings.content_silver | raw }}
          {% else %}
            {{ section.settings.content_member | raw }}
        {% endcase %}
      </div>
    </div>

    <div id="discord" class="customer-tab-content">
      <h3 style="text-align:left; margin-bottom: 20px;">Helios Community</h3>
      <div style="margin-bottom: 20px;"><img src="https://cdn.shopify.com/s/files/1/0644/2958/8701/files/z6465765703069_030e64083cc975d6127ff8a441409631_95f8c0e0-1f78-4f16-b036-4de58aa1d26c.jpg?v=1743569814" alt=""/></div>
      <p>Helios Club là cộng đồng dành riêng cho những người ‘khác biệt’– những anh em quan tâm đến thời trang, phụ kiện và đặc biệt là những ai đam mê ‘màu’ Helios.</p>
          
      <p>Đây là nơi để anh em chia sẻ trải nghiệm, kinh nghiệm sử dụng phụ kiện, những câu chuyện phía sau món đồ; đồng thời là không gian mở để đặt câu hỏi, tư vấn, trao đổi và thảo luận một cách thẳng thắn và chân thành.</p>
          
      <p>Nếu bạn yêu thích sự khác biệt: Chào mừng bạn đến với Helios Club!</p>
      <a href="https://www.facebook.com/groups/508707569692422" title=""><button>Tham gia ngay</button></a>
    </div>
    

    <!-- <div id="wishlist" class="customer-tab-content">
      <h3 style="text-align:left">Wishlist</h3>
      <p>Your saved items.</p>
    </div> -->
  </div>
</div>
<style>
        .custom-tier-content {
            background-image: url(https://helios.vn/cdn/shop/files/29.4_NH_b_n_v_WEB_CHRYSABER-01.jpg?v=1745913975);
            background-position: center center;
            min-height: 700px;
            align-items: center;
            display: flex;
            font-weight: 600;
        }
        .welcome-tier {
            max-width: 1400px;
            margin: 0 auto;
            text-align: center;
            line-height: 1.7;
            font-size: 1.5rem;
            padding: 30px 20px;
        }
        .befenits-container {
            max-width: 100%;
            margin: 0 auto;
        }

        .benefits-section {
            padding: 0;
        }

        .section-title {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 30px;
            text-transform: uppercase;
        }

        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .benefit-card {
            text-align: center;
        }

        .benefit-image {
            width: 100%;
            background: #ffffff;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            color: white;
        }

        .benefit-text {
            font-size: 16px;
            font-weight: 600;
            line-height: 1.6;
            text-transform: uppercase;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .benefits-section {
                padding: 0;
            }
            .section-title {
                font-size: 24px;
                margin-bottom: 30px;
            }

            .benefits-grid {
                grid-template-columns: 1fr;
                gap: 25px;
            }
            .benefit-image {
                height: auto;
                font-size: 50px;
            }

            .benefit-text {
                font-size: 15px;
            }
        }
</style>
<script>
document.querySelectorAll('.tab-link').forEach(tab => {
  tab.addEventListener('click', function () {
    document.querySelectorAll('.tab-link').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.customer-tab-content').forEach(el => el.classList.remove('active'));
    
    this.classList.add('active');
    document.getElementById(this.dataset.tab).classList.add('active');
  });
});

</script>
{% schema %}
{
  "name": "Main Account",
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "title",
      "name": "Title",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "heading_h1",
          "label": "Set as primary page heading",
          "info": "Uses <h1> tag. One per page recommended. [Learn more](https://cleancanvas.co.uk/support/showcase/seo#inner-anchor-0)",
          "default": true
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "html",
      "id": "content_black_diamond",
      "label": "Nội dung BLACK DIAMOND"
    },
    {
      "type": "html",
      "id": "content_diamond",
      "label": "Nội dung DIAMOND"
    },
    {
      "type": "html",
      "id": "content_platinum",
      "label": "Nội dung PLATINUM"
    },
    {
      "type": "html",
      "id": "content_gold",
      "label": "Nội dung GOLD"
    },
    {
      "type": "html",
      "id": "content_silver",
      "label": "Nội dung SILVER"
    },
    {
      "type": "html",
      "id": "content_member",
      "label": "Nội dung MEMBER"
    }
  ],
  "presets": [
    {
      "name": "Main Account",
      "settings": {}
    }
  ]
}
{% endschema %}
